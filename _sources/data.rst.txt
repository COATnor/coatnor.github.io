.. _data:

Data upload
==================================

Check for protocol
-------------------------------

**Warning:** Before uploading a dataset you have to be sure that the related protocol is already in the portal.
If it's not yet available, follow the instruction for :ref:`protocol upload <protocol>`



.. contents::
    :depth: 2
    :local:

Upload a dataset
-------------------------------

* Login with a user with editor role for the module the dataset belongs to
* Go to Datasets and select "Add Dataset" (if not visible, you are not authorized: contact the module leader)

.. image:: _images/addataset.png
    :align: center
    :width: 92%

* The title should be identical to the dataset name
* The title should follow formatting rules (starting with \V_ \ for datasets from Varanger and \S_ \ for datasets from Svalbard)
* Add a short description of the dataset. Here an example in Markdown format:
* Select an embargo policy. If the dataset doesn't require an embargo, go on with next point. If your dataset include data less than 2 years old, you could select an embargo end date. Read the detailed instructions on how to manage embargo data and dataset versions :ref:`here <embargo>`
* After filling all metadata, select Next: "Add data"
* Upload all the data file in the following order, add a filename (best to keep the file's name by click on "Fill field with filename or URL") and choose the correct file format


.. contents::
    :depth: 2
    :local:

Data files upload order
-------------------------------

#. Upload the **readme** file as a PDF/A. A description can be added, for example: "Additional information about the dataset, including a description of the variables included in the dataset"

#. Upload the **auxiliary file/s** A description can be added, for example: "Auxiliary information about the sampling sites including information about whem the site has been included in the sampling design"

#. Upload the **coordinates** file. A description can be added, for example: "Coordinates of all sites included in the dataset"

#. Upload all **data files** in chronological order (from older to newer)

.. contents::
    :depth: 2
    :local:

Data files upload order
-------------------------------

When a dataset is created, it defaults to "private" status.
A private dataset is not visible or accessible by unregistered or regular users.
Only logged-in users which are members or editors of the module including the dataset can see it


.. contents::
    :depth: 2
    :local:

Publishing the dataset
-------------------------------

After the upload is completed, the dataset can be set to *'Public'* by selecting **'Manage'** in the
menu of the dataset and setting the *'Visibility'* metadata element to *'Public'*.

.. contents::
    :depth: 2
    :local:

.. image:: _images/manage.png

.. image:: _images/arrow.png
    :align: center


.. image:: _images/visibility.png

Dataset Versions
-------------------------------

Datasets already published cannot be removed or modified, because of the FAIR requirement of being permanent and findable for citation and reuse purposes.
whenever a dataset content changes, it is necessary to create a new version of it.

.. contents::
    :depth: 2
    :local:

Embargo management
-------------------------------

.. _embargo:

Datasets in embargo follow a particular setup, which guarantees availability of older data contents and protection of more recent ones.

By default COAT data follow an Open Data policy. There is however the possibility to set an embargo for data files up to 2 years old.

**Warning:** *the embargo management is a bit complex, please read carefully the details below:*

When a dataset contains data files which should be kept in embargo (not reachable),
there is a specific workflow to follow, which implies the use of dataset versions.
It requires to create more than one version of a dataset, with the first version without an embargo, with data files reachable, and one or two versions in embargo, without data access
Such a workflow allows visualizing the most updated metadata, and the list of files, but keeps accessible only data from the non-embargoed dataset.

A user selects the embargo end date for the versions with embargo data files.
A dataset version in embargo will keep the data files inaccessible until the embargo end date, then will automatically make them available on embargo end date.
Not authorized users will be informed that a dataset is under umbargo, and need to look for a pervious version (the one with non-embargoed data files)

Let's see an example...

Ola Nordmann is a data portal's editor. On January 1st 2021 he decides to upload a new dataset containing one data file per year (from 2000 to 2020).
Since he is working on a PhD thesis, he opts for keeping the latest 2 years of data in embargo (the only eligible for such exception).
No one will blame Ola Normann for this choice, even if everyone knows that keeping all the data public is the best.

Here his workflow:

* Ola creates the first dataset version, which contains only data which can be public (from year 2000 to year 2018), and calls it "sample_dataset".
* This dataset will be automatically labelled as "sample_dataset_v1".
* Ola publishes "sample_dataset_v1".
* Ola creates a new version using the "New Version" button, which will create automatically "sample_dataset_v2".
* Ola adds 1 data file containing data for the year 2019, so that "sample_dataset_v2" contains data from 2000 to 2019.
* Ola sets the embargo end date on January 1st 2022, and publishes "sample_dataset_v2".
* Ola creates a third version of the dataset, "sample_dataset_v3" including year 2020, with embargo end date January 1st 2023.
* Ola publishes also "sample_dataset_v3"
* Ola may use python or R (ckanr) scripts using his api key credentials to download even the embargo files whenever needed.
* After 1 year, "sample_dataset_v2" removes all the blocks to data access, letting available also data from year 2019, and becomes the default version of the dataset (the latest published version).
* Ola now has one more year of data, 2021, and creates a new version, including 2000 - 2021 (embargoed) with embargo end date january 1st 2023.
* And so on...




.. contents::
    :depth: 2
    :local:

